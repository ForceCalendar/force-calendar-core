<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lightning Calendar Core - Interactive Demo</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="page">
        <header class="site-header">
            <div class="header-content">
                <h1>Lightning Calendar Core - Interactive Demo</h1>
                <nav>
                    <a href="index.html">Home</a>
                    <a href="https://github.com/thedhanawada/lightning-calendar-core">GitHub</a>
                </nav>
            </div>
        </header>

        <div class="demo-controls">
            <div class="control-row">
                <label>Timezone:</label>
                <select id="timezoneSelect" aria-label="Select timezone">
                    <option value="America/New_York">America/New_York</option>
                    <option value="America/Chicago">America/Chicago</option>
                    <option value="America/Los_Angeles">America/Los_Angeles</option>
                    <option value="Europe/London">Europe/London</option>
                    <option value="Europe/Paris">Europe/Paris</option>
                    <option value="Asia/Tokyo">Asia/Tokyo</option>
                    <option value="Asia/Shanghai">Asia/Shanghai</option>
                    <option value="Australia/Sydney">Australia/Sydney</option>
                    <option value="UTC">UTC</option>
                </select>
                <span id="currentTime" class="timezone-display" aria-live="polite"></span>
            </div>

            <div class="control-row">
                <label>View:</label>
                <button class="btn active" data-view="month" aria-pressed="true">Month</button>
                <button class="btn" data-view="week" aria-pressed="false">Week</button>
                <button class="btn" data-view="day" aria-pressed="false">Day</button>
                <button class="btn" data-view="list" aria-pressed="false">List</button>
            </div>

            <div class="control-row">
                <button class="btn" id="prevBtn" aria-label="Previous period">Previous</button>
                <button class="btn" id="todayBtn" aria-label="Go to today">Today</button>
                <button class="btn" id="nextBtn" aria-label="Next period">Next</button>
            </div>

            <div class="control-row">
                <button class="btn" id="detectConflictsBtn">Detect Conflicts</button>
                <button class="btn" id="clearBtn">Clear All</button>
            </div>
        </div>

        <div class="demo-container">
            <div id="calendar" class="calendar-container" role="application" aria-label="Calendar">
                <!-- Calendar renders here -->
            </div>

            <div class="info-panel">
                <div class="panel-section">
                    <h3>Quick Add Event</h3>
                    <form class="event-form" id="eventForm">
                        <div class="form-group">
                            <label for="eventTitle">Title</label>
                            <input type="text" id="eventTitle" required>
                        </div>
                        <div class="form-group">
                            <label for="eventDate">Date</label>
                            <input type="date" id="eventDate" required>
                        </div>
                        <div class="form-group">
                            <label for="startTime">Start Time</label>
                            <input type="time" id="startTime" value="09:00" required>
                        </div>
                        <div class="form-group">
                            <label for="endTime">End Time</label>
                            <input type="time" id="endTime" value="10:00" required>
                        </div>
                        <div class="form-group">
                            <label for="eventTz">Timezone</label>
                            <select id="eventTz">
                                <option value="America/New_York">New York</option>
                                <option value="America/Los_Angeles">Los Angeles</option>
                                <option value="Europe/London">London</option>
                                <option value="Asia/Tokyo">Tokyo</option>
                            </select>
                        </div>
                        <button type="submit">Add Event</button>
                    </form>
                </div>

                <div class="panel-section">
                    <h3>Conflicts</h3>
                    <div id="conflictInfo" class="conflict-list">
                        <p class="muted">No conflicts detected</p>
                    </div>
                </div>

                <div class="panel-section">
                    <h3>Statistics</h3>
                    <dl class="stats">
                        <dt>Total Events</dt>
                        <dd id="totalEvents">0</dd>

                        <dt>Events Today</dt>
                        <dd id="todayEvents">0</dd>

                        <dt>Active Timezones</dt>
                        <dd id="timezoneCount">0</dd>

                        <dt>Conflicts</dt>
                        <dd id="conflictCount">0</dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        class CalendarDemo {
            constructor() {
                this.events = [];
                this.currentView = 'month';
                this.currentDate = new Date();
                this.currentTimezone = 'America/New_York';
                this.eventIdCounter = 1;

                this.init();
            }

            init() {
                this.setupEventListeners();
                this.loadSampleEvents();
                this.render();
                this.updateTime();
                setInterval(() => this.updateTime(), 1000);
            }

            setupEventListeners() {
                document.getElementById('timezoneSelect').addEventListener('change', (e) => {
                    this.currentTimezone = e.target.value;
                    this.render();
                    this.updateTime();
                });

                document.querySelectorAll('[data-view]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('[data-view]').forEach(b => {
                            b.classList.remove('active');
                            b.setAttribute('aria-pressed', 'false');
                        });
                        e.target.classList.add('active');
                        e.target.setAttribute('aria-pressed', 'true');
                        this.currentView = e.target.dataset.view;
                        this.render();
                    });
                });

                document.getElementById('prevBtn').addEventListener('click', () => this.navigate(-1));
                document.getElementById('todayBtn').addEventListener('click', () => {
                    this.currentDate = new Date();
                    this.render();
                });
                document.getElementById('nextBtn').addEventListener('click', () => this.navigate(1));

                document.getElementById('detectConflictsBtn').addEventListener('click', () => this.detectConflicts());
                document.getElementById('clearBtn').addEventListener('click', () => {
                    if (confirm('Clear all events?')) {
                        this.events = [];
                        this.render();
                    }
                });

                document.getElementById('eventForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addEventFromForm();
                });

                document.getElementById('eventDate').value = new Date().toISOString().split('T')[0];

                document.addEventListener('keydown', (e) => {
                    if (e.target.matches('input, select, button')) return;

                    if (e.key === 'ArrowLeft') {
                        this.navigate(-1);
                    } else if (e.key === 'ArrowRight') {
                        this.navigate(1);
                    } else if (e.key === 't') {
                        this.currentDate = new Date();
                        this.render();
                    }
                });
            }

            loadSampleEvents() {
                const today = new Date();
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);

                this.events = [
                    {
                        id: this.eventIdCounter++,
                        title: 'NY Team Standup',
                        start: new Date(today.getFullYear(), today.getMonth(), today.getDate(), 9, 0),
                        end: new Date(today.getFullYear(), today.getMonth(), today.getDate(), 9, 30),
                        timezone: 'America/New_York'
                    },
                    {
                        id: this.eventIdCounter++,
                        title: 'London Client Call',
                        start: new Date(today.getFullYear(), today.getMonth(), today.getDate(), 14, 0),
                        end: new Date(today.getFullYear(), today.getMonth(), today.getDate(), 15, 0),
                        timezone: 'Europe/London'
                    },
                    {
                        id: this.eventIdCounter++,
                        title: 'Tokyo Product Review',
                        start: new Date(tomorrow.getFullYear(), tomorrow.getMonth(), tomorrow.getDate(), 10, 0),
                        end: new Date(tomorrow.getFullYear(), tomorrow.getMonth(), tomorrow.getDate(), 11, 0),
                        timezone: 'Asia/Tokyo'
                    },
                    {
                        id: this.eventIdCounter++,
                        title: 'Quarterly Planning',
                        start: new Date(today.getFullYear(), today.getMonth(), today.getDate() + 5, 13, 0),
                        end: new Date(today.getFullYear(), today.getMonth(), today.getDate() + 5, 15, 0),
                        timezone: 'America/Los_Angeles'
                    }
                ];

                for (let week = 0; week < 4; week++) {
                    const date = new Date(today);
                    date.setDate(date.getDate() + (week * 7) + 1);
                    this.events.push({
                        id: this.eventIdCounter++,
                        title: 'Weekly Sync',
                        start: new Date(date.getFullYear(), date.getMonth(), date.getDate(), 11, 0),
                        end: new Date(date.getFullYear(), date.getMonth(), date.getDate(), 12, 0),
                        timezone: 'America/New_York',
                        recurring: true
                    });
                }

                this.updateStats();
            }

            addEventFromForm() {
                const title = document.getElementById('eventTitle').value;
                const date = document.getElementById('eventDate').value;
                const startTime = document.getElementById('startTime').value;
                const endTime = document.getElementById('endTime').value;
                const timezone = document.getElementById('eventTz').value;

                const [year, month, day] = date.split('-').map(Number);
                const [startHour, startMin] = startTime.split(':').map(Number);
                const [endHour, endMin] = endTime.split(':').map(Number);

                this.events.push({
                    id: this.eventIdCounter++,
                    title: title,
                    start: new Date(year, month - 1, day, startHour, startMin),
                    end: new Date(year, month - 1, day, endHour, endMin),
                    timezone: timezone
                });

                document.getElementById('eventForm').reset();
                document.getElementById('eventDate').value = new Date().toISOString().split('T')[0];

                this.render();
                this.updateStats();
            }

            navigate(direction) {
                if (this.currentView === 'month') {
                    this.currentDate.setMonth(this.currentDate.getMonth() + direction);
                } else if (this.currentView === 'week') {
                    this.currentDate.setDate(this.currentDate.getDate() + (direction * 7));
                } else {
                    this.currentDate.setDate(this.currentDate.getDate() + direction);
                }
                this.render();
            }

            detectConflicts() {
                const conflicts = [];
                for (let i = 0; i < this.events.length; i++) {
                    for (let j = i + 1; j < this.events.length; j++) {
                        const e1 = this.events[i];
                        const e2 = this.events[j];
                        if (e1.start < e2.end && e2.start < e1.end) {
                            conflicts.push({ e1, e2 });
                        }
                    }
                }

                const container = document.getElementById('conflictInfo');
                if (conflicts.length === 0) {
                    container.innerHTML = '<p class="muted">No conflicts detected</p>';
                } else {
                    container.innerHTML = conflicts.map(c =>
                        `<div class="conflict-item">${c.e1.title} conflicts with ${c.e2.title}</div>`
                    ).join('');
                }

                document.getElementById('conflictCount').textContent = conflicts.length;
            }

            updateTime() {
                const now = new Date();
                const formatter = new Intl.DateTimeFormat('en-US', {
                    timeZone: this.currentTimezone,
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    timeZoneName: 'short'
                });
                document.getElementById('currentTime').textContent = formatter.format(now);
            }

            updateStats() {
                const today = new Date();
                const todayEvents = this.events.filter(e =>
                    e.start.toDateString() === today.toDateString()
                );

                const timezones = new Set(this.events.map(e => e.timezone));

                document.getElementById('totalEvents').textContent = this.events.length;
                document.getElementById('todayEvents').textContent = todayEvents.length;
                document.getElementById('timezoneCount').textContent = timezones.size;
            }

            render() {
                const container = document.getElementById('calendar');

                switch (this.currentView) {
                    case 'month':
                        this.renderMonth(container);
                        break;
                    case 'week':
                        this.renderWeek(container);
                        break;
                    case 'day':
                        this.renderDay(container);
                        break;
                    case 'list':
                        this.renderList(container);
                        break;
                }

                this.updateStats();
            }

            renderMonth(container) {
                const year = this.currentDate.getFullYear();
                const month = this.currentDate.getMonth();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const startDate = new Date(firstDay);
                startDate.setDate(startDate.getDate() - firstDay.getDay());

                const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                                  'July', 'August', 'September', 'October', 'November', 'December'];
                const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

                let html = `
                    <div class="calendar-header">
                        ${monthNames[month]} ${year}
                    </div>
                    <div class="weekday-headers">
                        ${dayNames.map(d => `<div class="weekday">${d}</div>`).join('')}
                    </div>
                    <div class="month-days">
                `;

                for (let i = 0; i < 42; i++) {
                    const date = new Date(startDate);
                    date.setDate(startDate.getDate() + i);
                    const isToday = date.toDateString() === new Date().toDateString();
                    const isOtherMonth = date.getMonth() !== month;
                    const isWeekend = date.getDay() === 0 || date.getDay() === 6;
                    const dayEvents = this.getEventsForDate(date);

                    let classes = 'calendar-day';
                    if (isToday) classes += ' today';
                    if (isOtherMonth) classes += ' other-month';
                    if (isWeekend && !isOtherMonth) classes += ' weekend';

                    html += `
                        <div class="${classes}">
                            <div class="day-number">${date.getDate()}</div>
                            ${dayEvents.slice(0, 3).map(e => `
                                <div class="calendar-event" title="${e.title} (${e.timezone})" tabindex="0">
                                    ${this.formatTime(e.start)} ${e.title}
                                </div>
                            `).join('')}
                            ${dayEvents.length > 3 ? `<div class="more-events">+${dayEvents.length - 3} more</div>` : ''}
                        </div>
                    `;
                }

                html += '</div>';
                container.innerHTML = html;
            }

            renderWeek(container) {
                const startOfWeek = new Date(this.currentDate);
                startOfWeek.setDate(startOfWeek.getDate() - startOfWeek.getDay());

                let html = '<div class="week-view">';

                for (let i = 0; i < 7; i++) {
                    const date = new Date(startOfWeek);
                    date.setDate(startOfWeek.getDate() + i);
                    const dayEvents = this.getEventsForDate(date);
                    const isToday = date.toDateString() === new Date().toDateString();

                    html += `
                        <div class="week-day ${isToday ? 'today' : ''}">
                            <h4>${date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}</h4>
                            ${dayEvents.map(e => `
                                <div class="calendar-event" tabindex="0">
                                    <div>${this.formatTime(e.start)}</div>
                                    <div>${e.title}</div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }

                html += '</div>';
                container.innerHTML = html;
            }

            renderDay(container) {
                const dayEvents = this.getEventsForDate(this.currentDate);

                let html = `
                    <div class="day-view">
                        <div class="calendar-header">
                            ${this.currentDate.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' })}
                        </div>
                `;

                for (let hour = 6; hour <= 20; hour++) {
                    const hourEvents = dayEvents.filter(e => e.start.getHours() === hour);
                    html += `
                        <div class="hour-slot">
                            <div class="hour-time">${String(hour).padStart(2, '0')}:00</div>
                            <div>
                                ${hourEvents.map(e => `
                                    <div class="calendar-event" tabindex="0">
                                        ${e.title} (${this.formatTime(e.start)} - ${this.formatTime(e.end)})
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }

                html += '</div>';
                container.innerHTML = html;
            }

            renderList(container) {
                const sortedEvents = [...this.events].sort((a, b) => a.start - b.start);

                let html = `
                    <div class="list-view">
                        <div class="calendar-header">All Events (${sortedEvents.length})</div>
                `;

                let currentDate = null;
                sortedEvents.forEach(event => {
                    const dateStr = event.start.toDateString();
                    if (dateStr !== currentDate) {
                        currentDate = dateStr;
                        html += `<div class="list-day">
                            <h4>${event.start.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' })}</h4>
                        `;
                    }
                    html += `
                        <div class="calendar-event list-item" tabindex="0">
                            <span class="event-time">${this.formatTime(event.start)}</span>
                            ${event.title}
                            <span class="muted">${event.timezone}</span>
                        </div>
                    `;
                });

                if (currentDate) html += '</div>';
                html += '</div>';
                container.innerHTML = html;
            }

            getEventsForDate(date) {
                return this.events.filter(event =>
                    event.start.toDateString() === date.toDateString()
                );
            }

            formatTime(date) {
                return date.toLocaleTimeString('en-US', {
                    hour: 'numeric',
                    minute: '2-digit',
                    hour12: true
                }).toLowerCase().replace(' ', '');
            }
        }

        new CalendarDemo();
    </script>
</body>
</html>
